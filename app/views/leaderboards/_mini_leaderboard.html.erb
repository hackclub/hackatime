<%
  entries = leaderboard.entries.includes(:user).order(total_seconds: :desc)
  if current_user
    user_rank = entries.find_index { |entry| entry.slack_uid == current_user.slack_uid }
    if user_rank && user_rank >= 3
      # Show top 2 entries and immediate competition
      top_entries = entries[0..1]
      competition_entries = entries[[user_rank - 1, 2].max..[user_rank + 1, entries.size - 1].min]
      mini_leaderboard_entries = top_entries + competition_entries
      show_top_entries = false
    else
      # Show top 3 entries (either user is in top 3 or not on leaderboard)
      mini_leaderboard_entries = entries.first(3)
      show_top_entries = true
    end
  else
    # Not logged in, show top 3
    mini_leaderboard_entries = entries.first(3)
    show_top_entries = true
  end
%>

<% if mini_leaderboard_entries&.any? %>
  <div class="mini-leaderboard">
    <div class="leaderboard-entries">
      <% mini_leaderboard_entries.each_with_index do |entry, idx| %>
        <% is_competition = !show_top_entries && idx >= 2 %>
        <div class="leaderboard-entry <%= 'current-user' if entry.slack_uid == current_user&.slack_uid %>">
          <% if !is_competition %>
            <% rank_emoji = case entries.index(entry)
               when 0 then "ðŸ¥‡"
               when 1 then "ðŸ¥ˆ"
               when 2 then "ðŸ¥‰"
               end %>
            <span class="rank"><%= rank_emoji %></span>
          <% else %>
            <% if idx == 2 %>
              <div class="leaderboard-break">...</div>
            <% end %>
            <span class="rank"><%= (entries.index(entry) + 1).ordinalize %></span>
          <% end %>
          <span class="user" style="display: inline-block;">
            <%= render "shared/user_mention", user: entry.user %>
          </span>
          <span class="time"><%= Time.at(entry.total_seconds).utc.strftime("%H:%M:%S") %></span>
        </div>
      <% end %>
    </div>
  </div>
<% end %> 