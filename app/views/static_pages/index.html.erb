<% if current_user %>
  <div class="homepage-container">
    <!-- Sidebar Navigation -->
    <div class="homepage-sidebar">
      <!-- Navigation Buttons -->
      <div class="homepage-nav">
        <%= link_to root_path, class: "homepage-nav-button #{current_page?(root_path) ? 'active' : ''}" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="homepage-nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
          </svg>
          <span>home</span>
        <% end %>
        
        <%= link_to my_projects_path, class: "homepage-nav-button #{current_page?(my_projects_path) ? 'active' : ''}" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="homepage-nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2z"/>
          </svg>
          <span>projects</span>
        <% end %>
        
        <%= link_to leaderboards_path, class: "homepage-nav-button #{current_page?(leaderboards_path) ? 'active' : ''}" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="homepage-nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z"/>
          </svg>
          <span>statistics</span>
        <% end %>
      </div>
      
      <!-- User Card -->
      <div class="homepage-user-card">
        <div class="homepage-user-header">
          <% if current_user.avatar_url %>
            <img src="<%= current_user.avatar_url %>" alt="<%= current_user.display_name %>" class="homepage-user-avatar">
          <% else %>
            <div class="homepage-user-avatar-placeholder">
              <%= current_user.display_name[0] %>
            </div>
          <% end %>
          <span class="homepage-user-name"><%= current_user.display_name %></span>
        </div>
        
        <div class="homepage-user-status">
          <span class="homepage-user-status-icon">ðŸ’¤</span>
          <span class="homepage-user-status-text">No active session</span>
        </div>
        
        <%= link_to my_settings_path, class: "homepage-settings-button" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="homepage-settings-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
          </svg>
        <% end %>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="homepage-main">
      <% if current_user.trust_level == "red" %>
        <div class="homepage-alert homepage-alert-banned">
          <div class="homepage-alert-content">
            <svg xmlns="http://www.w3.org/2000/svg" class="homepage-alert-icon" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 14.5a6.5 6.5 0 1 0 0-13a6.5 6.5 0 0 0 0 13M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m1-5a1 1 0 1 1-2 0a1 1 0 0 1 2 0m-.25-6.25a.75.75 0 0 0-1.5 0v3.5a.75.75 0 0 0 1.5 0z" clip-rule="evenodd" /></svg>
            <span class="homepage-alert-text">Hold up! Your account has been banned for suspicious activity.</span>
          </div>
        </div>
      <% end %>
      
      <!-- Welcome Section -->
      <div class="homepage-welcome">
        <h1>
          welcome back,<br>
          <%= current_user.display_name %>
        </h1>
        <p>imagine a world where everyone ships code daily.</p>
      </div>
      
      <!-- Stats Card -->
      <div class="homepage-stats-card">
        <div class="homepage-stats-container">
          <!-- Streak -->
          <div class="homepage-streak">
            <div class="homepage-streak-icon-wrapper">
              <div class="homepage-streak-icon-bg">
                <span class="homepage-streak-icon">ðŸ”¥</span>
              </div>
              <div class="homepage-streak-count">
                <span><%= current_user.streak_days %></span>
              </div>
            </div>
            <div class="homepage-streak-text">
              <p class="homepage-streak-label">you have a</p>
              <p class="homepage-streak-value"><%= current_user.streak_days %> days streak</p>
            </div>
          </div>
          
          <!-- Hours Coded -->
          <div class="homepage-stat-box hours">
            <p class="homepage-stat-number"><%= (@todays_duration / 3600.0).round %></p>
            <p class="homepage-stat-label">HOURS CODED</p>
          </div>
          
          <!-- Rank -->
          <% 
            leaderboard = LeaderboardService.get(period: :daily, date: Date.current)
            user_rank = leaderboard&.entries&.find_index { |e| e.user_id == current_user.id }
            rank_display = user_rank ? "##{user_rank + 1}" : "#?"
          %>
          <div class="homepage-stat-box rank">
            <p class="homepage-stat-number"><%= rank_display %></p>
            <p class="homepage-stat-label">AMONG FRIENDS</p>
          </div>
        </div>
      </div>
      
      <!-- Weekly Progress & Activity Chart -->
      <div class="homepage-activity">
        <!-- Weekly Comparison -->
        <%
          last_week_duration = current_user.heartbeats.where(time: 1.week.ago.beginning_of_week.to_f..1.week.ago.end_of_week.to_f).duration_seconds
          this_week_duration = current_user.heartbeats.where(time: Time.current.beginning_of_week.to_f..Time.current.to_f).duration_seconds
          percentage_change = last_week_duration > 0 ? ((this_week_duration - last_week_duration).to_f / last_week_duration * 100).round : 0
          change_sign = percentage_change >= 0 ? "+" : ""
        %>
        <div class="homepage-weekly-comparison">
          <div class="homepage-weekly-left">
            <span class="homepage-weekly-percentage"><%= "#{change_sign}#{percentage_change}%" %></span>
            <span class="homepage-weekly-label">Weekly Coding Time vs last week</span>
          </div>
          <span class="homepage-weekly-hours"><%= short_time_detailed(this_week_duration) %></span>
        </div>
        
        <!-- Last 7 Days Activity -->
        <div class="homepage-activity-chart">
          <h3 class="homepage-activity-title">Last 7 Days Activity</h3>
          <div class="homepage-chart-container">
            <div class="homepage-chart-yaxis">
              <% [ 5, 4, 3, 2, 1, 0 ].each do |hour| %>
                <span><%= hour %>h</span>
              <% end %>
            </div>
            <div class="homepage-chart-bars">
              <% 7.times do |i| %>
                <% 
                  date = (6 - i).days.ago.to_date
                  duration = Time.use_zone(current_user.timezone) do
                    current_user.heartbeats.where(time: date.beginning_of_day.to_f..date.end_of_day.to_f).duration_seconds
                  end
                  max_height = 5.hours
                  height_percentage = [(duration.to_f / max_height * 100).round, 5].max
                %>
                <div class="homepage-chart-bar-wrapper">
                  <div class="homepage-chart-bar" 
                       style="height: <%= height_percentage %>%"
                       title="<%= short_time_detailed(duration) %>">
                  </div>
                  <span class="homepage-chart-day"><%= date.strftime('%a') %></span>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      
      <% if @show_wakatime_setup_notice %>
        <div class="homepage-setup-notice">
          <p class="homepage-setup-text">
            Hello friend! Looks like you are new around here, let's get you set up so you can start tracking your coding time.
          </p>
          <%= link_to "Let's setup Hackatime! Click me :D", my_wakatime_setup_path, class: "homepage-setup-button" %>
        </div>
      <% end %>
    </div>
    
    <!-- Right Sidebar - Leaderboard -->
    <div class="homepage-leaderboard">
      <div class="homepage-leaderboard-card">
        <div class="homepage-leaderboard-header">
          <h2 class="homepage-leaderboard-title">leaderboard</h2>
          <div class="homepage-leaderboard-tabs">
            <button class="homepage-leaderboard-tab active">friends</button>
            <button class="homepage-leaderboard-tab">global</button>
          </div>
        </div>
        
        <%= turbo_frame_tag "mini_leaderboard", src: mini_leaderboard_static_pages_path do %>
          <%= render "leaderboards/mini_leaderboard_loading" %>
        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <!-- Original logged-out view -->
  <div class="fixed bottom-6 right-4 bg-primary w-[30px] h-[30px] rounded-b-full flex justify-center items-center z-50 bounce" id="scroll-arrow">
    <img src="/images/down-arrow.svg" class="w-8 h-8" />
  </div>
  <div class="container">
    <div class="flex items-center space-x-2 mt-2">
      <p class="italic text-gray-400 m-0">
        <%= @flavor_text %>
      </p>
    </div>
    <div id="clock" class="ds-digital clock-display">
    </div>
    <h1 class="font-bold mt-1 mb-1 text-5xl text-center">Track How Much You <span class="text-primary">Code</span></h1>
    <div class="flex flex-col w-full max-w-[50vw] mx-auto mb-22">
      <%= link_to slack_auth_path, class: "inline-flex items-center justify-center px-6 py-3 rounded text-white font-bold cursor-pointer border-none w-full my-2 bg-primary" do %>
        <img src="/images/slack.png" class="h-8 w-8 mr-2 bg-white rounded-full p-1" />
        <span class="hidden md:flex">Sign in with Hack Club Slack</span>
      <% end %>

      <div class="flex items-center my-4">
        <div class="flex-1 border-t border-gray-600"></div>
        <span class="px-4 text-gray-400 text-sm">or</span>
        <div class="flex-1 border-t border-gray-600"></div>
      </div>

      <%= form_tag email_auth_path, class: "relative", data: { turbo: false } do %>
        <div class="relative">
          <%= email_field_tag :email, nil, placeholder: "Enter your email to get a sign in link", required: true, class: "w-full px-3 py-3 pr-12 border border-gray-600 rounded text-base bg-gray-800 text-white" %>
          <button type="submit" class="absolute right-2 top-1/2 transform -translate-y-1/2 w-8 h-8 p-1 bg-blue-600 hover:bg-blue-700 rounded cursor-pointer border-none flex items-center justify-center transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M13.3 20.275q-.3-.3-.3-.7t.3-.7L16.175 16H7q-.825 0-1.412-.587T5 14V5q0-.425.288-.712T6 4t.713.288T7 5v9h9.175l-2.9-2.9q-.3-.3-.288-.7t.288-.7q.3-.3.7-.312t.7.287L19.3 14.3q.15.15.212.325t.063.375t-.063.375t-.212.325l-4.575 4.575q-.3.3-.712.3t-.713-.3"/></svg>
          </button>
        </div>
      <% end %>
    </div>
    <% if params[:sign_in_email] %>
      <div class="text-green-500 mt-4 text-center max-w-[50vw] mx-auto">
        Check your email for a sign-in link!
      </div>
      <% dev_tool class: "text-center max-w-[50vw] mx-auto mb-4" do %>
        Because you're on localhost, <%= link_to "click here to view the email", letter_opener_web_path %>
      <% end %>
    <% end %>
    <div class="w-full flex justify-center overflow-x-none">
      <p class="monospace text-center text-primary text-[22px] select-none whitespace-nowrap">
        ==============================================/ h a c k /=============================================
      </p>
    </div>
    <div class="mt-8 mb-8">
      <h1 class="font-bold mt-1 mb-1 text-4xl">Compatible with your favourite IDEs</h1>
      <p class="text-primary monospace text-[20px]">Hackatime works with these code editors and more!</p>
      <div id="supported-editors" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mt-4">
        <% popular_editors = [
          ['VS Code', 'vs-code'], ['PyCharm', 'pycharm'], ['IntelliJ IDEA', 'intellij-idea'],
          ['Sublime Text', 'sublime-text'], ['Vim', 'vim'], ['Neovim', 'neovim'],
          ['Android Studio', 'android-studio'], ['Xcode', 'xcode'], ['Unity', 'unity'],
          ['Godot', 'godot'], ['Cursor', 'cursor'], ['Zed', 'zed'],
          ['Terminal', 'terminal'], ['WebStorm', 'webstorm'], ['Eclipse', 'eclipse'],
          ['Emacs', 'emacs'], ['Jupyter', 'jupyter'], ['OnShape', 'onshape']
        ] %>
        <% popular_editors.each do |name, slug| %>
          <a href="<%= doc_path("editors/#{slug}") %>" class="bg-darkless rounded-lg p-3 hover:bg-primary/10 transition-all duration-200 text-center block hover:translate-y-[-2px] hover:shadow-lg hover:shadow-blue-500/20">
            <img src="/images/editor-icons/<%= slug %>-128.png" alt="<%= name %>" class="w-12 h-12 mx-auto mb-2">
            <div class="text-sm text-white"><%= name %></div>
          </a>
        <% end %>
      </div>
    </div>
    <div class="w-full flex justify-center overflow-x-none">
      <p class="monospace text-center text-primary text-[22px] select-none whitespace-nowrap">
        -----------------------------------------------------------------------------------------------
      </p>
    </div>
    <div class="mt-8 mb-8">
      <h1 class="font-bold mt-1 mb-1 text-4xl">Why Hackatime?</h1>
      <% if @home_stats&.[](:seconds_tracked) && @home_stats&.[](:users_tracked) %>
        <p class="text-primary monospace text-[20px]">
          We've tracked over <span class="text-primary"><%= number_with_delimiter(@home_stats[:seconds_tracked] / 3600) %> <%= 'hour'.pluralize(@home_stats[:seconds_tracked] / 3600) %></span> of coding time across <span class="text-primary"><%= number_with_delimiter(@home_stats[:users_tracked]) %> <%= 'high schooler'.pluralize(@home_stats[:users_tracked]) %></span> since <span class="text-primary">2025</span>!
        </p>
      <% end %>
      <div class="overflow-x-auto -mx-4 px-4 pb-4 no-scrollbar">
        <div class="grid grid-cols-4 gap-4 mt-4 text-center h-30 min-w-[800px] select-none cursor-pointer">
          <p class="flex flex-col text-3xl justify-center bg-darkless rounded-lg p-3 hover:bg-primary/10 transition-all duration-200 text-center hover:translate-y-[-2px] hover:shadow-lg hover:shadow-blue-500/20"><span class="text-green font-bold text-4xl">100%</span><br>free</p>
          <p class="flex flex-col text-3xl justify-center bg-darkless rounded-lg p-3 hover:bg-primary/10 transition-all duration-200 text-center hover:translate-y-[-2px] hover:shadow-lg hover:shadow-blue-500/20">works<br><span class="text-green font-bold text-4xl">offline</span></p>
          <p class="flex flex-col text-3xl justify-center bg-darkless rounded-lg p-3 hover:bg-primary/10 transition-all duration-200 text-center hover:translate-y-[-2px] hover:shadow-lg hover:shadow-blue-500/20"><span class="text-green font-bold text-4xl">real time</span><br>stats</p>
          <p class="flex flex-col text-3xl justify-center bg-darkless rounded-lg p-3 hover:bg-primary/10 transition-all duration-200 text-center hover:translate-y-[-2px] hover:shadow-lg hover:shadow-blue-500/20">rise to the<br><span class="text-green font-bold text-4xl">top #1</span></p>
        </div>
      </div>
    </div>
    <div class="w-full flex justify-center overflow-x-none">
      <p class="monospace text-center text-primary text-[22px] select-none whitespace-nowrap">
        --------------------------------| #hackclub | #hackclub | #hackclub |--------------------------------
      </p>

    </div>
    <div class="mt-8 mb-8">
      <h1 class="font-bold mt-1 mb-1 text-4xl">For your favourite <span class="text-primary">Hack Club</span> events!</span></h1>
      <p class="text-primary monospace text-[20px]">Don't commit fraud lol ;)</p>
      <div class="flex flex-col md:flex-row bg-[url('/images/som-bg.png')] mt-4 mb-4 rounded-lg">
        <div class="w-full md:w-1/2 p-8">
          <img src="/images/som.png" class="h-2/3 mx-auto md:mx-0 mb-6" />
          <%= link_to "Start building", "https://summer.hackclub.com/", class: "inline-block bg-[#592F31] font-primary font-bold text-[#f6dbba] px-4 py-2 rounded-[100px] text-[22px] hover:scale-105 transition-transform duration-200", target: "_blank" %>
        </div>
        <div class="w-full md:w-1/2 p-8 pl-4 pr-4 grid grid-cols-1 gap-4">
          <div class="som-box p-4">
            <h2 class="font-bold text-[22px]">Build Projects</h2>
            <p class="text-[18px]">Build websites, games, apps, or any other personal open-source coding projects to showcase your skills.</p>
          </div>
          <div class="som-box p-4">
            <h2 class="font-bold text-[22px]">Get Stuff</h2>
            <p class="text-[18px]">Get awesome prizes like Raspberry Pis, Server hosting credits, 3D printers, and more to fuel your next creation.</p>
          </div>
        </div>
      </div>
      <div class="flex flex-col md:flex-row bg-gradient-to-r from-[#EFCCCC] to-[#D35648] mt-4 mb-4 rounded-lg">
        <div class="w-full md:w-1/3 translate-y-[-20px]">
          <img src="/images/athena.png" class="w-[400px]" />
        </div>
        <div class="w-full md:w-2/3 p-8 pl-4 pr-4">
          <img src="/images/athena_award.svg" class="h-24 mb-4" />
          <p class="text-[18px] m-4">Earn an <b>industry recognized technical certificate</b> for coding 30 hours and building 3 personal projects. Win prizes as you code, and a chance to travel to NYC for 2025's largest high school hackathon for girls.</p>
          <%= link_to "Join Athena", "https://athena.hackclub.com/", class: "inline-block bg-white font-primary font-bold text-[#D35648] px-4 py-2 m-4 rounded-[100px] text-[22px] hover:scale-105 transition-transform duration-200", target: "_blank" %>
        </div>
      </div>
    </div>
    <% if @leaderboard %>
      <h3>Today's Top Hack Clubbers</h3>
      <%= render "leaderboards/mini_leaderboard", leaderboard: @leaderboard, current_user: nil %>
    <% end %>

    <div class="w-full flex justify-center overflow-x-none">
      <p class="monospace text-center text-primary text-[22px] select-none whitespace-nowrap">
      ==============================================/ h a c k /=============================================
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 my-8 items-center">
      <div class="w-full relative pb-[56.25%] h-0 overflow-hidden">
        <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/eFVA_ZWnzDk?si=TcEVwiigFZh0Sp_Z&loop=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen class="absolute top-0 left-0 w-full h-full rounded-lg"></iframe>
      </div>

      <div>
        <h1 class="font-bold mt-1 mb-1 text-5xl">Start hacking with <span class="text-primary">Hackatime</span> now!</h1>
        <p class="text-primary monospace text-[20px]">Superrrrrr easy to setup :)</p>
      </div>
    </div>
  </div>
<% end %>
